# このプロジェクトの問題点

このドキュメントは、`HmOpenKiroFromHidemaru` プロジェクトにおける潜在的な問題点をまとめたものです。

## 秀丸マクロに関する問題点 (`HmOpenKiroFromHidemaru.mac`)

1.  **Kiroへのパス解決が不安定**
    - `kiro.exe`（実体はVS Code）へのパスをレジストリや`where`コマンドで探索していますが、これはユーザーのインストール状況によっては失敗する可能性があります（例：ユーザーインストール、ポータブル版）。
    - マクロファイル内にパスを直接書き込める仕様ですが、より堅牢な設定方法が望まれます。

2.  **複雑な非同期処理**
    - `git`の情報を取得するために、マクロ内で非同期プロセスを実行し、`setTimeout`や`postExecMacroMemory`を駆使して同期処理に繋げています。このロジックは非常に複雑で、デバッグや改修が困難です。
    - 非同期処理の結果をグローバル変数経由で渡しており、予期せぬ挙動の原因となる可能性があります。

3.  **不安定なプロセス間連携**
    - VS Code拡張機能にSCM（ソース管理）ビューを開かせるため、一時ファイル (`HmOpenKiroFromHidemaru.txt`) を作成するという方法に依存しています。これは競合やファイルの残存リスクがあり、信頼性の低い方法です。

4.  **マジックナンバーの使用**
    - カーソル位置の再計算ロジック (`calcCenterPosition`) で、`13`という具体的な数値が根拠なく使われています。これは特定の環境ではうまく機能しない可能性があります。

## VS Code拡張機能に関する問題点 (`kiro_extension/`)

1.  **ソースコードの欠如（最重要）**
    - `package.json`にはTypeScriptでの開発環境が示唆されていますが、リポジトリにはコンパイル後のJavaScriptファイル (`extension.js`) しか含まれていません。
    - 元のTypeScriptソースコードがないため、バグ修正や機能追加といったメンテナンスが極めて困難です。

2.  **非効率なアクティベーション**
    - `onStartupFinished`というイベントで拡張機能を有効化しています。これにより、秀丸からの連携を使わない場合でも、VS Codeの起動時に毎回不要なファイルチェック処理が実行されてしまいます。

3.  **OSへの依存**
    - 一時フォルダのパスを `process.env.TEMP` から取得していますが、これはWindows固有の環境変数です。Node.jsの `os.tmpdir()` を使えば、macOSやLinuxにも対応でき、より堅牢になります。

4.  **不完全な実装**
    - ファイル削除 (`fs.unlink`) 時のエラーハンドリングが実装されていません。
    - `require` (CommonJS) を使用しており、よりモダンな`import` (ESM) への移行が望まれます。

## プロジェクト全体に関する問題点

1.  **テストの欠如**
    - 秀丸マクロとVS Code拡張機能の両方に、自動テストが存在しません。これにより、将来の変更が既存の機能を壊してしまう（リグレッション）リスクを検知できません。

2.  **ドキュメント不足**
    - `README.md`以外の開発者向けドキュメント（アーキテクチャ、ビルド方法、テスト手順など）がありません。

3.  **不明瞭なプロジェクト構造**
    - 秀丸マクロとVS Code拡張機能という、技術的に異なる2つの要素が1つのリポジトリで管理されています。それぞれのサブディレクトリに専用の`README.md`を配置するなど、より明確な構造化が望まれます。
